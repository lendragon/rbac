<!-- <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"> -->
<div class="row">
  <div class="col-md-9">
    <button id="addUserBtn" class="btn btn-primary">新增</button>
    <button
      id="batchDeleteBtn"
      class="btn btn-danger"
      disabled
      onclick="batchDelete()"
    >
      批量删除
    </button>
  </div>
  <script>
    function batchDelete() {
      let checked = $(".select-row:checked");
      let usersId = [];
      checked.each(function () {
        usersId.push(parseInt($(this).parent().next().text()));
      });
      deleteUsers(usersId);
    }
  </script>
  <div class="col-md-3">
    <form id="searchForm" class="form-inline" role="search">
      <div class="form-group">
        <input type="text" class="form-control" placeholder="请输入搜索内容" />
      </div>
      <button type="submit" class="btn btn-default">查询</button>
    </form>
  </div>
</div>
<script>
  // 监听表单提交事件
  searchFormEvent();
</script>

<!-- 展示用户数据的表格 -->
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th><input type="checkbox" id="select-all" /></th>
      <th>ID</th>
      <th>用户编号</th>
      <th>用户名</th>
      <th>性别</th>
      <th>生日</th>
      <th>手机号码</th>
      <th>创建时间</th>
      <th>修改时间</th>
      <th class="col-xs-2">操作</th>
    </tr>
  </thead>
  <tbody id="userData"></tbody>
</table>
<script>
  $(() => {
    let data = [
      {
        id: 1,
        no: "001",
        name: "admin",
        password: "admin",
        sex: 0,
        birthDay: 1386806400000,
        phoneNum: "11111111",
        createTime: 1702396800000,
        updateTime: 1702870249000,
      },
      {
        id: 2,
        no: "002",
        name: "张三",
        password: "1234",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702396800000,
        updateTime: 1702396800000,
      },
      {
        id: 3,
        no: "003",
        name: "李四",
        password: "1234",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702396800000,
        updateTime: 1702396800000,
      },
      {
        id: 4,
        no: "004",
        name: "王五",
        password: "1234",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702396800000,
        updateTime: 1702396800000,
      },
      {
        id: 28,
        no: "006",
        name: "赵六",
        password: "7e236424ad2fb23dffc92427cec12fab",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702525756000,
        updateTime: 1702525756000,
      },
      {
        id: 39,
        no: "123",
        name: "123",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947227000,
        updateTime: 1702947227000,
      },
      {
        id: 38,
        no: "123",
        name: "123",
        password: "7e236424ad2fb23dffc92427cec12fab",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947222000,
        updateTime: 1702947222000,
      },
      {
        id: 37,
        no: "123",
        name: "123",
        password: "7e236424ad2fb23dffc92427cec12fab",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947216000,
        updateTime: 1702947216000,
      },
      {
        id: 36,
        no: "123",
        name: "123",
        password: "7e236424ad2fb23dffc92427cec12fab",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947212000,
        updateTime: 1702947212000,
      },
      {
        id: 40,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947235000,
        updateTime: 1702947235000,
      },
      {
        id: 41,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947240000,
        updateTime: 1702947240000,
      },
      {
        id: 42,
        no: "123",
        name: "12345",
        password: "6f718d965862794bc0f150a74ee244ee",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947248000,
        updateTime: 1702947248000,
      },
      {
        id: 43,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947253000,
        updateTime: 1702947253000,
      },
      {
        id: 44,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947257000,
        updateTime: 1702947257000,
      },
      {
        id: 45,
        no: "123",
        name: "12345",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947264000,
        updateTime: 1702947264000,
      },
      {
        id: 46,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947269000,
        updateTime: 1702947269000,
      },
      {
        id: 47,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947273000,
        updateTime: 1702947273000,
      },
      {
        id: 48,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947286000,
        updateTime: 1702947286000,
      },
      {
        id: 49,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947291000,
        updateTime: 1702947291000,
      },
      {
        id: 50,
        no: "123",
        name: "1234",
        password: "7d8334f115758f93b3cb5e976e07b185",
        sex: 0,
        birthDay: null,
        phoneNum: null,
        createTime: 1702947295000,
        updateTime: 1702947295000,
      },
    ];

    createTable("#userData", changeJsonToArr(data));
  });

  function changeJsonToArr(data) {
    let properties = [
      "id",
      "no",
      "name",
      "sex",
      "birthDay",
      "phoneNum",
      "createTime",
      "updateTime",

    ];
    return data.map((obj) => properties.map((prop) => {
      if (prop === "birthDay") {
        return isEmpty(obj[prop]) ? "null" : formatDate(obj[prop], false);
      }
      if (prop === "createTime" || prop === "updateTime") {
        return formatDate(obj[prop], false);
      }
      return obj[prop];
    }));
  }

  // 查看用户详情
  function userDetail(userId) {
    createFormBox(
      "userDetail",
      "用户详情",
      [
        {
          label: "ID",
          type: "text",
          name: "id",
          required: true,
          disabled: true,
          value: 1,
        },
        {
          label: "用户编号",
          type: "text",
          name: "no",
          required: true,
          placeholder: "用户编号",
          reg: "^[0-9]{3}$",
          regTitle: "请输入3位数字",
        },
        {
          label: "用户名",
          type: "text",
          name: "name",
          required: true,
          placeholder: "用户名",
          reg: "^.{2,12}$",
          regTitle: "请输入2-12位的字符",
        },
        {
          label: "密码",
          type: "password",
          name: "password",
          required: true,
          placeholder: "密码",
          reg: "^[^\u4e00-\u9fa5]{4,16}$",
          regTitle: "请输入4-16位的数字、字母或特殊字符",
        },
        {
          label: "性别",
          type: "radio",
          name: "sex",
          required: false,
          options: [
            {
              name: "无",
              value: "",
              checked: true,
            },
            {
              name: "男",
              value: "1",
            },
            {
              name: "女",
              value: "2",
            },
          ],
          placeholder: "性别",
        },
        {
          label: "出生日期",
          type: "date",
          name: "birthDay",
          required: false,
          placeholder: "出生日期",
          value: formatDate(0, false),
        },
        {
          label: "电话",
          type: "text",
          name: "phoneNum",
          required: false,
          placeholder: "电话",
          reg: "^$|^[0-9]{7,15}$",
          regTitle: "请输入有效电话号码",
        },
        {
          label: "创建时间",
          type: "date",
          name: "createTime",
          required: false,
          disabled: true,
          value: formatDate(new Date(1702396800000), false),
        },
        {
          label: "修改时间",
          type: "date",
          name: "updateTime",
          required: false,
          disabled: true,
        },
      ],
      1,
      (data, closeFun) => {
        confirmBox("提示", "确定修改吗?", 0, true, true, () => {
          console.log(data);
          closeFun();
        });
      },
      "修改"
    );
  }

  // 删除用户
  function deleteUsers(usersId) {
    confirmBox("提示", "确定删除?", 1, true, true, () => {
      let data = {};
      if (typeof usersId === "number") {
        data.id = [];
        data.id.push(usersId);
      } else {
        data.id = usersId;
      }

      let a = $.param(data).replaceAll("%5B%5D", "");
      console.log(a);
      console.log(JSON.stringify(data));
      successMessageFloat("删除成功");
    });
  }
</script>

<script>
  /* 表格多选框 */
  // 全选/取消全选
  // tableCheckBoxAll();
  // $("#select-all").prop("checked", false);
  tableCheckBoxEvent();
</script>

<!-- 底层分页 -->
<nav aria-label="Page navigation">
  <ul class="pagination">
    <li id="lastPageBtn">
      <a href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    <li class="pageBtn" onclick="togglePageBtn(event, undefined)">
      <a href="#">1</a>
    </li>
    <li class="pageBtn" onclick="togglePageBtn(event, undefined)">
      <a href="#">2</a>
    </li>
    <li class="pageBtn" onclick="togglePageBtn(event, undefined)">
      <a href="#">3</a>
    </li>
    <li class="pageBtn" onclick="togglePageBtn(event, undefined)">
      <a href="#">4</a>
    </li>
    <li class="pageBtn" onclick="togglePageBtn(event, undefined)">
      <a href="#">5</a>
    </li>
    <li id="nextPageBtn">
      <a href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>
<!-- 分页组件点击事件编写 -->
<script>
  // 给按钮监听点击事件
  $(() => {
    $($(".pageBtn")[pageNo - 1]).addClass("active");
    $(".pageBtn").click(togglePageBtn);
    $("#nextPageBtn").click(nextTogglePageBtn);
    $("#lastPageBtn").click(lastTogglePageBtn);
    $("#addUserBtn").click(addUserFormBox);
  });

  // 分页组件点击切换
  function togglePageBtn(event, object) {
    //   var activeElement = document.querySelector('.pageBtn .active');
    // $(activeElement).removeClass('active');
    let realObject;
    let activeObject = $(".pageBtn.active");
    if (typeof object === "undefined") {
      realObject = $(this);
    } else {
      realObject = object;
    }
    if (realObject === activeObject) {
      return;
    }

    activeObject.removeClass("active");
    realObject.addClass("active");
    pageNo = realObject.text();
  }

  // 下一个按钮
  function nextTogglePageBtn() {
    if (pageNo >= $(".pageBtn").length) {
      return;
    }
    togglePageBtn(event, $(".pageBtn.active + .pageBtn"));
  }

  // 上一个按钮
  function lastTogglePageBtn() {
    if (pageNo <= 1) {
      return;
    }
    togglePageBtn(event, $($(".pageBtn")[pageNo - 2]));
  }

  // 新增用户
  function addUser(data) {
    let password = data.password;
    let hash = CryptoJS.MD5(password).toString();
    let sign = CryptoJS.AES.encrypt(hash, AES_KEY).toString();
    password = CryptoJS.AES.encrypt(password, AES_KEY).toString();
    console.log(
      CryptoJS.AES.decrypt(password, AES_KEY).toString(CryptoJS.enc.Utf8)
    );
    data["password"] = password;
    data["sign"] = sign;
    console.log(data);
    successMessageFloat("新增成功");
  }

  // 新增用户的表单
  function addUserFormBox() {
    createFormBox(
      "addUser",
      "新增用户",
      [
        {
          label: "用户编号",
          type: "text",
          name: "no",
          required: true,
          placeholder: "用户编号",
          reg: "^[0-9]{3}$",
          regTitle: "请输入3位数字",
        },
        {
          label: "用户名",
          type: "text",
          name: "name",
          required: true,
          placeholder: "用户名",
          reg: "^.{2,12}$",
          regTitle: "请输入2-12位的字符",
        },
        {
          label: "密码",
          type: "password",
          name: "password",
          required: true,
          placeholder: "密码",
          reg: "^[^\u4e00-\u9fa5]{4,16}$",
          regTitle: "请输入4-16位的数字、字母或特殊字符",
        },
        {
          label: "性别",
          type: "radio",
          name: "sex",
          required: false,
          options: [
            {
              name: "无",
              value: "",
              checked: true,
            },
            {
              name: "男",
              value: "1",
            },
            {
              name: "女",
              value: "2",
            },
          ],
          placeholder: "性别",
        },
        {
          label: "出生日期",
          type: "date",
          name: "birthDay",
          required: false,
          placeholder: "出生日期",
        },
        {
          label: "电话",
          type: "text",
          name: "phoneNum",
          required: false,
          placeholder: "电话",
          reg: "^$|^[0-9]{7,15}$",
          regTitle: "请输入有效电话号码",
        },
      ],
      1,
      (data, closeFun) => {
        addUser(data);
        closeFun();
      }
    );
  }
</script>

<button
  type="button"
  class="btn btn-primary"
  data-toggle="modal"
  data-target="#myModal"
>
  打开弹窗
</button>

<div id="myModal" class="modal modal-vertical-center fade" role="dialog">
  <div class="modal-dialog modal-dialog-vertical-center modal-slow-fade">
    <div class="modal-content">
      <!-- 弹窗内容 -->
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
        <h4 class="modal-title">弹窗标题</h4>
      </div>
      <div class="modal-body">
        <p>弹窗内容...</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">
          关闭
        </button>
      </div>
    </div>
  </div>
</div>

<button
  type="button"
  class="btn btn-primary"
  data-toggle="tooltip"
  data-placement="top"
  title="提示框内容"
>
  提示框
</button>

<script>
  $(document).ready(function () {
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>

<button id="confirmBtn" type="button" class="btn btn-primary">确认框</button>
<script>
  $("#confirmBtn").click(function () {
    // $('#myModal').modal(options)
    confirmBox("提示", "这是一个确认框", -1);
  });
</script>

<!-- <div id="myAlert" class="alert alert-success" style="position: fixed; top: 0; left: 0; width: 200px; z-index: 9999;">
    <strong>成功！</strong>结果是成功的。
</div> -->
<button id="your-button">a</button>
<script>
  $(() => {
    $("#your-button").click(infoMessageFloat);
  });
</script>
