# 1、 系统设计

## 1） 流程图

http://192.168.42.193:8080/?lang=zh

![image-20231212150935176](images/image-20231212150935176.png)

## 2） E-R图

![image-20231212173046432](images/image-20231212173046432.png)

# 2、 表设计

用户表、角色表、菜单表、用户_角色关系表、角色\_菜单关系表



## 1） 用户表:

表名 : CT_Rbac_User

| 名称        | 字段类型     | 是否必填 | 描述           |
| ----------- | ------------ | -------- | -------------- |
| ID          | int(16)      | 是       | 主键,自增      |
| FNo         | varchar(30)  | 是       | 用户编号       |
| FName       | varchar(30)  | 是       | 用户名         |
| FPassword   | varchar(128) | 是       | 密码           |
| FSex        | int(12)      | 否       | 1\|男;2\|女;   |
| FBirthDay   | datetime     | 否       | 生日, 默认为空 |
| FPhoneNum   | varchar(30)  | 否       | 手机号         |
| FCreateTime | datetime     | 是       | 创建时间       |
| FUpdateTime | datetime     | 否       | 修改时间       |



## 2） 角色表:

表名: CT_Rbac_Role

| 名称         | 字段类型     | 是否必填 | 描述       |
| ------------ | ------------ | -------- | ---------- |
| ID           | int(16)      | 是       | 主键, 自增 |
| FName        | varchar(30)  | 是       | 角色名称   |
| FCreateTime  | datetime     | 是       | 创建时间   |
| FUpdateTime  | datetime     | 否       | 修改时间   |
| FDescription | varchar(255) | 否       | 角色描述   |



## 3） 菜单表:

表名: CT_Rbac_Menu

| 名称         | 字段类型     | 是否必填 | 描述         |
| ------------ | ------------ | -------- | ------------ |
| ID           | int(16)      | 是       | 主键, 自增   |
| FName        | varchar(30)  | 是       | 菜单名称     |
| FOrder       | int(12)      | 是       | 菜单显示顺序 |
| FLevel       | int(12)      | 是       | 菜单层级     |
| FParentId    | int(16)      | 否       | 父菜单ID     |
| FUrl         | varchar(255) | 否       | 菜单路径     |
| FCreateTime  | datetime     | 是       | 创建时间     |
| FUpdateTime  | datetime     | 否       | 修改时间     |
| FDescription | varchar(255) | 否       | 菜单描述     |



## 4） 用户_角色关系表:

表名: CT_Rbac_User_Role

| 名称    | 字段类型 | 是否必填 | 描述       |
| ------- | -------- | -------- | ---------- |
| ID      | int(16)  | 是       | 主键, 自增 |
| FUserID | int(16)  | 是       | 用户标识   |
| FRoleID | int(16)  | 是       | 角色标识   |



## 5） 角色_菜单关系表:

表名: CT_Rbac_Role_Menu

| 名称    | 字段类型 | 是否必填 | 描述       |
| ------- | -------- | -------- | ---------- |
| ID      | int(16)  | 是       | 主键, 自增 |
| FRoleID | int(16)  | 是       | 角色标识   |
| FMenuID | int(16)  | 是       | 菜单标识   |



# 3、 接口设计

## 1） 用户crud接口

### a) 查询用户

地址: **/livecloud/project/user.pagex?action=query**

方法: get

数据提交方式: 表单提交

**inputs:** 

```javascript
"pageNo": Number,	// 页码, 非必要
"pageSize": Number,	// 页长, 非必要
"keyword": String,	// 查询关键字, 非必要
"id": Number		// 查询的用户id, 非必要
```

**outputs:**

```javascript
{
    "code": Number,		// 识别码
    "success": Boolean,	// 接口是否成功
    "msg": String,		// 消息
    "data": {
        "records": [
            {
                "id": Number,		// 用户id
                "no": String,		// 用户编号
                "name": String,		// 用户名
                "password": String,	// 密码
                "sex": Number,		// 性别
                "birthDay": Date,	// 生日
                "phoneNum": String,	// 手机号
                "createTime": Date,	// 创建时间
                "updateTime": Date	// 修改时间
            },
            ...
        ],
        "total": Number	// 数据库中的总数目
    }
}
```





### b) 新增用户

地址: **/livecloud/project/user.pagex?action=add**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "user" : {
        "no": String,		// 用户编号
        "name": String,		// 用户名
        "password": String,	// 密码, 提交的是aes加密过后的数据
        "phoneNum": String,	// 电话号码
        "sex": Number,		// 性别
        "birthDay": Date,	// 生日
        "phoneNum": String,	// 电话号码
    },
    "iv": String		// 数字签名
}
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



### c) 修改用户

地址: **/livecloud/project/user.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "user" : {
        "id": Number,		// 用户标识
        "no": String,		// 用户编号
        "name": String,		// 用户名
        "password": String,	// 密码
        "phoneNum": String,	// 电话号码
        "sex": Number,		// 性别
        "birthDay": Date,	// 生日
        "phoneNum": String,	// 电话号码
    },
    "iv": String		// 数字签名
}
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



### d) 修改用户的角色

地址: **/livecloud/project/userRole.pagex?action=update**

方法: post

数据提交方式: 表单提交

**inputs:**

```typescript
"userId": Number,	// 用户标识
"roleI": Array		// 角色标识
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



### e) 删除用户

地址: **/livecloud/project/user.pagex?action=delete**

方法: post

数据提交方式: 表单提交

**inputs:**

```typescript
"id": Number	// 用户标识
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



## 2） 角色crud接口

### a) 查询角色

地址: **/livecloud/project/role.pagex?action=query**

方法: get

数据提交方式: 表单提交

**inputs:**

```javascript
"pageNo": Number,	// 页码, 非必要
"pageSize": Number,	// 页长, 非必要
"keyword": String,	// 查询关键字, 非必要
"userId": Number	// 要查询的用户id, 非必要
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": [
        {
            "id": Number,			// 角色标识
            "name": String,			// 角色名
            "description": String,	// 角色描述
            "createTime": Date,		// 创建时间
            "updateTime": Date		// 修改时间
        },
        ...
    ]
}
```



### b) 新增角色

地址: **/livecloud/project/role.pagex?action=add**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "name": String,			// 角色名
	"description": String	// 角色描述
}
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": string,
    "data": Null
}
```



### c) 修改角色

地址: **/livecloud/project/role.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "id": Number,			// 角色标识
    "name": String,			// 角色名
    "description": String	// 角色描述
}
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



### d) 修改角色的菜单

地址: **/livecloud/project/roleMenu.pagex?action=update**

方法: post

数据提交方式: 表单提交

**inputs:**

```typescript
"roleId": Number,	// 角色标识, 必填
"menuId": Array		// 菜单标识, 必填
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```





### e) 删除角色

地址: **/livecloud/project/role.pagex?action=delete**

方法: post

数据提交方式: 表单提交

**inputs:**

```javascript
"id": Number	// 角色标识
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



## 3） 菜单crud接口



### a) 查询菜单树

地址: **/livecloud/project/menu.pagex?action=query**

方法: get

数据提交方式: 表单提交

**inputs: **

```javascript
"roleId": Number	// 角色id, 非必要
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": [
        {
            "id": String,			// 菜单标识
            "name": String,			// 菜单名
            "order": Number,		// 菜单显示顺序
            "level": Number,		// 菜单层级
            "parentId": Number,		// 父菜单id
            "url": String,			// 菜单路径
            "createTime": Date,		// 创建时间
            "updateTime": Date,		// 修改时间
            "description": String,	// 菜单描述
            "children": [
                {
                    "id": String,			// 菜单标识
                    "name": String,			// 菜单名
                    "order": Number,		// 菜单显示顺序
                    "level": Number,		// 菜单层级
                    "parentId": Number,		// 父菜单id
                    "url": String,			// 菜单路径
                    "createTime": Date,		// 创建时间
                    "updateTime": Date,		// 修改时间
                    "description": String,	// 菜单描述
                    "children": [
                        ...
                    ]
                },
                ...
            ]
        },
        ...
    ]
}
```



### b) 新增菜单

地址: **/livecloud/project/menu.pagex?action=add**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "name": String,			// 菜单名
    "order": Number,		// 菜单显示顺序
    "level": Number,		// 菜单层级
    "parentId": Number,		// 父菜单id
    "url": String,			// 菜单路径
    "description": String	// 菜单描述
}

```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



### c) 修改菜单

地址: **/livecloud/project/menu.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "id": Number,			// 菜单标识
    "name": String,			// 菜单名
    "order": Number,		// 菜单显示顺序
    "level": Number,		// 菜单层级
    "parentId": Number,		// 父菜单id
    "url": String,			// 菜单路径
    "description": String	// 菜单描述
}
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```



### d) 删除菜单

地址: **/livecloud/project/menu.pagex?action=delete**

方法: post

数据提交方式: 表单提交

**inputs:**

```typescript
"id": Number	// 菜单标识
```

**outputs:**

```javascript
{
    "code": Number,
    "success": Boolean,
    "msg": String,
    "data": Null
}
```

# 4、 页面设计

## 1） 用户列表

## 2） 角色列表

## 3） 菜单列表