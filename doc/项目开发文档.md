#   一、 系统设计

## 2. 流程图

http://192.168.42.193:8080/?lang=zh

![  ](images/image-20231212150935176.png)

## 3. E-R图

<img src="images/image-20231221150359153.png" alt="image-20231221150359153"  />

# 二、 表设计

用户表、角色表、菜单表、用户_角色关系表、角色\_菜单关系表



## 1. 用户表:

表名 : CT_Rbac_User

| 名称        | 字段类型     | 是否必填 | 描述                    |
| ----------- | ------------ | -------- | ----------------------- |
| ID          | int(16)      | 是       | 主键,自增               |
| FUserCode   | varchar(30)  | 是       | 用户编码                |
| FName       | varchar(30)  | 是       | 用户名                  |
| FPassword   | varchar(128) | 是       | 密码                    |
| FSex        | int(12)      | 否       | 0\|男;1\|女;            |
| FBirthDay   | datetime     | 否       | 生日, 默认为空          |
| FPhoneNum   | varchar(30)  | 否       | 手机号                  |
| FState      | int(12)      | 是       | 0\|正常;1\|禁用;2\|删除 |
| FCreateTime | datetime     | 是       | 创建时间                |
| FUpdateTime | datetime     | 否       | 修改时间                |



## 2. 角色表:

表名: CT_Rbac_Role

| 名称         | 字段类型     | 是否必填 | 描述                  |
| ------------ | ------------ | -------- | --------------------- |
| ID           | int(16)      | 是       | 主键, 自增            |
| FRoleCode    | varchar(30)  | 是       | 角色编码              |
| FName        | varchar(30)  | 是       | 角色名称              |
| FState       | int(12)      | 是       | 0\|正常;1\|禁用;2删除 |
| FDescription | varchar(255) | 否       | 角色描述              |
| FCreateTime  | datetime     | 是       | 创建时间              |
| FUpdateTime  | datetime     | 否       | 修改时间              |



## 3. 菜单表:

表名: CT_Rbac_Menu

| 名称         | 字段类型     | 是否必填 | 描述                  |
| ------------ | ------------ | -------- | --------------------- |
| ID           | int(16)      | 是       | 主键, 自增            |
| FName        | varchar(30)  | 是       | 菜单名称              |
| FOrder       | int(12)      | 是       | 菜单显示顺序          |
| FLevel       | int(12)      | 是       | 菜单层级              |
| FParentId    | int(16)      | 否       | 父菜单ID              |
| FUrl         | varchar(255) | 否       | 菜单路径              |
| FState       | int(12)      | 是       | 0\|正常;1\|禁用;2删除 |
| FDescription | varchar(255) | 否       | 菜单描述              |
| FCreateTime  | datetime     | 是       | 创建时间              |
| FUpdateTime  | datetime     | 否       | 修改时间              |



## 4. 用户_角色关系表:

表名: CT_Rbac_User_Role

| 名称    | 字段类型 | 是否必填 | 描述       |
| ------- | -------- | -------- | ---------- |
| ID      | int(16)  | 是       | 主键, 自增 |
| FUserID | int(16)  | 是       | 用户id     |
| FRoleID | int(16)  | 是       | 角色id     |



## 5. 角色_菜单关系表:

表名: CT_Rbac_Role_Menu

| 名称    | 字段类型 | 是否必填 | 描述       |
| ------- | -------- | -------- | ---------- |
| ID      | int(16)  | 是       | 主键, 自增 |
| FRoleID | int(16)  | 是       | 角色id     |
| FMenuID | int(16)  | 是       | 菜单id     |



# 三、 接口设计

## 1） 用户crud接口

### 1) 查询所有用户

地址: **/livecloud/project/user.pagex?action=queryAll**

方法: get

数据提交方式: url参数拼接

**inputs:** 

```javascript
{
    "pageNo": number,	// 页码, 必填
    "pageSize": number,	// 页长, 必填
    "keyword": string,	// 查询关键字, 非必填
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": {
        "records": [
            {
                "userId": number,	// 用户id
                "userCode": string,	// 用户编码
                "name": string,		// 用户名
                "sex": number,		// 性别
                "birthDay": date,	// 生日
                "phoneNum": string,	// 手机号
                "state": number,	// 用户状态, 0正常,1禁用
                "createTime": date,	// 创建时间
                "updateTime": date	// 修改时间
            },
            ...
        ],
        "total": number,	// 总数
        "pageNo": number,	// 页码
        "pageSize": number	// 页长
            
    }
}
```



### 2) 根据用户id查询用户

地址: **/livecloud/project/user.pagex?action=queryByUserId**

方法: get

数据提交方式: url参数拼接

**inputs:** 

```javascript
{
    "userId": number,		// 要查询的用户id, 必填
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": {
        "userId": number,	// 用户id
        "userCode": string,	// 用户编码
        "name": string,		// 用户名
        "sex": number,		// 性别
        "birthDay": date,	// 生日
        "phoneNum": string,	// 手机号
        "state": number,	//用户状态, 0正常;1禁用
        "createTime": date,	// 创建时间
        "updateTime": date	// 修改时间
    }
}
```





### 3) 根据角色id查询用户

地址: **/livecloud/project/user.pagex?action=queryByRoleId**

方法: get

数据提交方式: url参数拼接

**inputs:** 

```javascript
{
    "roleId": number	// 要查询的角色id, 必填
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": [			// (会查询出所有的用户, 该角色授权的的checked字段为true, 否则为false)
        "userId": number,	// 用户id
        "userCode": string,	// 用户编码
        "name": string,		// 用户名
        "sex": number,		// 性别
        "birthDay": date,	// 生日
        "phoneNum": string,	// 手机号
        "state": number,	// 用户状态, 0正常;1禁用
        "createTime": date,	// 创建时间
        "updateTime": date,	// 修改时间
        "checked": boolean	// 该角色是否已授权给该用户
    ]
}
```



### 4) 新增用户

地址: **/livecloud/project/user.pagex?action=add**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "userCode": string,	// 用户编码, 必填且不能重复
    "name": string,		// 用户名, 必填
    "phoneNum": string,	// 电话号码
    "sex": number,		// 性别, 必填
    "birthDay": date,	// 生日
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 5) 修改用户

地址: **/livecloud/project/user.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "userId": number,	// 要修改的用户id, 必填
    "name": string,		// 用户名, 必填
    "phoneNum": string,	// 电话号码
    "sex": number,		// 性别, 必填, 0|男;1|女;
    "birthDay": date,	// 生日
    "state": number		// 用户状态, 必填, 0正常;1禁用;
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 6) 修改用户密码

地址: **/livecloud/project/user.pagex?action=updatePassword**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "userId": number,		// 要修改的用户id
    "oldPassword": string,	// 旧密码, 后端加密方式为md5加密
    "password": string		// 新密码
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 7) 批量删除用户

地址: **/livecloud/project/user.pagex?action=delete**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "userIds": array	// 用户id, 必填(number数组)
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



## 2） 角色crud接口

### 1) 查询所有角色

地址: **/livecloud/project/role.pagex?action=queryAll**

方法: get

数据提交方式: url参数拼接

**inputs:**

```javascript
"pageNo": number,	// 页码, 必填
"pageSize": number,	// 页长, 必填
"keyword": string,	// 查询关键字, 非必填
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": {
        "records": [
            {
                "roleId": number,			// 角色id
                "roleCode": string,		// 角色编码
                "name": string,			// 角色名
                "state": number,		// 角色状态,  0正常,1禁用
                "description": string,	// 角色描述
                "createTime": date,		// 创建时间
                "updateTime": date		// 修改时间
            },
        	...
    	],
        "total": number,	// 总数
        "pageNo": number,	// 页码
       	"pageSize": number	// 页长
    }
}
```



### 2) 根据用户id查询角色

地址: **/livecloud/project/role.pagex?action=queryByUserId**

方法: get

数据提交方式: url参数拼接

**inputs:**

```javascript
"userId": number	// 要查询的用户id, 必填
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": {
        "records": [
            {
                "roleId": number,			// 角色id
                "roleCode": string,		// 角色编码
                "name": string,			// 角色名
                "state": number,		// 角色状态,  0正常,1禁用
                "description": string	// 角色描述
            },
        	...
    	],
        "total": number,	// 总数
        "pageNo": number,	// 页码
       	"pageSize": number	// 页长
    }
}
```





### 3) 根据角色id查询角色

地址: **/livecloud/project/role.pagex?action=queryByRoleId**

方法: get

数据提交方式: url参数拼接

**inputs:**

```javascript
"roleId": number	// 要查询的角色id, 必填
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": {
        "roleId": number,		// 角色id
        "roleCode": string,		// 角色编码
        "name": string,			// 角色名
        "state": number,		// 角色状态,  0正常,1禁用
        "description": string,	// 角色描述
        "createTime": date,		// 创建时间
        "updateTime": date		// 修改时间
    }
}
```





### 4) 新增角色

地址: **/livecloud/project/role.pagex?action=add**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "roleCode": string,		// 角色编码, 必填
    "name": string,			// 角色名, 必填
	"description": string	// 角色描述
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 5) 修改角色

地址: **/livecloud/project/role.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "roleId": number,		// 角色id, 必填
    "name": string,			// 角色名, 必填
    "state": number,		// 角色状态, 必填,  0正常,1禁用
    "description": string	// 角色描述
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 6) 给用户授权角色

地址: **/livecloud/project/userRole.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "id": number,		// 要授权的角色id, 必填
    "addIds": array,	// 要添加的用户id列表
    "deleteIds": array	// 要删除的用户id列表
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 7) 修改角色的菜单

地址: **/livecloud/project/roleMenu.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "id": number,		// 要修改的角色id, 必填
    "addIds": array,	// 要添加的菜单id列表, (number数组)
    "deleteIds": array	// 要删除的菜单id列表, (number数组)
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```





### 8) 批量删除角色

地址: **/livecloud/project/role.pagex?action=delete**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "roleIds": array	// 角色id, 必填(number数组)
}
```

**outputs:**

```javascript
{
    "code": number,
    "success": boolean,
    "msg": string,
}
```



## 3） 菜单crud接口



### 1) 查询菜单树

地址: **/livecloud/project/menu.pagex?action=queryAll**

方法: get

数据提交方式: url参数拼接

**inputs: ** 无

**outputs:**

```javascript
{
    "code": number,
    "success": boolean,
    "msg": string,
    "data": [
        {
            "menuId": number,		// 菜单id
            "name": string,			// 菜单名
            "order": number,		// 菜单显示顺序
            "parentId": number,		// 父菜单id
            "url": string,			// 菜单路径
            "state": number,		// 菜单状态, 0正常, 1禁用
            "description": string,	// 菜单描述
            "createTime": date,		// 创建时间
            "updateTime": date,		// 修改时间
            "children": [
                {
                    "menuId": number,		// 菜单id
                    "name": string,			// 菜单名
                    "order": number,		// 菜单显示顺序
                    "parentId": number,		// 父菜单id
                    "url": string,			// 菜单路径
                    "state": number,		// 菜单状态, 0正常, 1禁用
                    "description": string,	// 菜单描述
                    "createTime": date,		// 创建时间
                    "updateTime": date,		// 修改时间
                    "children": [
                        ...
                    ]
                },
                ...
            ]
        },
        ...
    ]
}
```



### 2) 根据用户id查询菜单树

地址: **/livecloud/project/menu.pagex?action=queryByUserId**

方法: get

数据提交方式: url参数拼接

**inputs: ** 

```javascript
{
    "userId": number	// 用户id. 必填
}
```

**outputs:**

```javascript
{
    "code": number,
    "success": boolean,
    "msg": string,
    "data": [
        {
            "menuId": number,		// 菜单id
            "name": string,			// 菜单名
            "order": number,		// 菜单显示顺序
            "parentId": number,		// 父菜单id
            "url": string,			// 菜单路径
            "state": number,		// 菜单状态, 0正常, 1禁用
            "description": string,	// 菜单描述
            "createTime": date,		// 创建时间
            "updateTime": date,		// 修改时间
            "children": [
                {
                    "menuId": number,		// 菜单id
                    "name": string,			// 菜单名
                    "order": number,		// 菜单显示顺序
                    "parentId": number,		// 父菜单id
                    "url": string,			// 菜单路径
                    "state": number,		// 菜单状态, 0正常, 1禁用
                    "description": string,	// 菜单描述
                    "createTime": date,		// 创建时间
                    "updateTime": date,		// 修改时间
                    "children": [
                        ...
                    ]
                },
                ...
            ]
        },
        ...
    ]
}
```



### 3) 根据角色id查询菜单树

地址: **/livecloud/project/menu.pagex?action=queryByRoleId**

方法: get

数据提交方式: url参数拼接

**inputs: ** 

```javascript
{
    "roleId": number	// 角色id. 必填
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": [			// (会查询出所有的菜单,该角色拥有的菜单checked字段为true, 否则为false)
        {
            "menuId": number,		// 菜单id
            "name": string,			// 菜单名
            "order": number,		// 菜单显示顺序
            "parentId": number,		// 父菜单id
            "url": string,			// 菜单路径
            "state": number,		// 菜单状态, 0正常, 1禁用
            "description": string,	// 菜单描述
            "createTime": date,		// 创建时间
            "updateTime": date,		// 修改时间
            "checked": boolean,		// 该角色是否拥有该菜单
            "children": [
                {
                    "menuId": number,		// 菜单id
                    "name": string,			// 菜单名
                    "order": number,		// 菜单显示顺序
                    "parentId": number,		// 父菜单id
                    "url": string,			// 菜单路径
                    "state": number,		// 菜单状态, 0正常, 1禁用
                    "description": string,	// 菜单描述
                    "createTime": date,		// 创建时间
                    "updateTime": date,		// 修改时间
                    "checked": boolean,		// 该角色是否拥有该菜单
                    "children": [
                        ...
                    ]
                },
                ...
            ]
        },
        ...
    ]
}
```





### 4) 根据菜单id查询菜单

地址: **/livecloud/project/menu.pagex?action=queryByRoleId**

方法: get

数据提交方式: url参数拼接

**inputs: ** 

```javascript
{
    "roleId": number	// 角色id. 必填
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string,		// 消息
    "data": {
        "menuId": number,		// 菜单id
        "name": string,			// 菜单名
        "order": number,		// 菜单显示顺序
        "level": number,		// 菜单层级
        "parentId": number,		// 父菜单id
        "url": string,			// 菜单路径
        "state": number,		// 菜单状态, 0正常, 1禁用
        "description": string,	// 菜单描述
        "createTime": date,		// 创建时间
        "updateTime": date,		// 修改时间
    }
}
```



### 5) 新增菜单

地址: **/livecloud/project/menu.pagex?action=add**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "name": string,			// 菜单名, 必填
    "order": number,		// 菜单显示顺序, 必填
    "parentId": number,		// 父菜单id, 必填
    "url": string,			// 菜单路径
    "description": string	// 菜单描述
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 6) 修改菜单

地址: **/livecloud/project/menu.pagex?action=update**

方法: post

数据提交方式: json格式提交

**inputs:**

```javascript
{
    "menuId": number,			// 菜单id, 必填
    "name": string,			// 菜单名, 必填
    "order": number,		// 菜单显示顺序, 必填
    "parentId": number,		// 父菜单id, 必填
    "url": string,			// 菜单路径
    "state": number,		// 菜单状态, 必填, 0正常; 1禁用
    "description": string	// 菜单描述
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```



### 7) 删除菜单

地址: **/livecloud/project/menu.pagex?action=delete**

方法: post

数据提交方式: json格式提交

**inputs:**

```typescript
{
    "menuId": number	// 菜单id, 必填
}
```

**outputs:**

```javascript
{
    "code": number,		// 识别码
    "success": boolean,	// 接口是否成功
    "msg": string		// 消息
}
```

# 三、 页面设计

## 1） 用户列表

![image-20231220174759918](images/image-20231220174759918.png)

## 2） 角色列表

![image-20231221134102773](images/image-20231221134102773.png)

## 3） 菜单列表

![image-20231220174821202](images/image-20231220174821202.png)